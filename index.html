<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>Comparador de Tarifas de Luz y Gas - Ahorra en Electricidad</title>
<meta name="description" content="Comparador de tarifas de luz y gas. Compara T2, T3 y RL1. Calcula tu ahorro mensual y anual. Gratuito, sin registro. Pega datos de tus facturas.">
<meta name="robots" content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1">
<link rel="canonical" href="https://comparadortarifasluzygas.livinkcoworking.es/">
<meta name="theme-color" content="#667eea">
<meta name="author" content="LIVINK">
<link rel="icon" type="image/svg+xml" href="favicon.svg">
<!-- Open Graph Meta Tags -->
<meta property="og:type" content="website">
<meta property="og:url" content="https://comparadortarifasluzygas.livinkcoworking.es/">
<meta property="og:title" content="Comparador de Tarifas de Luz y Gas - Ahorra en Electricidad">
<meta property="og:description" content="Compara tarifas de electricidad T2, T3 y gas RL1. Calcula tu ahorro mensual y anual. Herramienta gratuita y sin registro.">
<meta property="og:image" content="https://comparadortarifasluzygas.livinkcoworking.es/favicon.svg">
<!-- Twitter Card Meta Tags -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:url" content="https://comparadortarifasluzygas.livinkcoworking.es/">
<meta name="twitter:title" content="Comparador de Tarifas de Luz y Gas - Ahorra en Electricidad">
<meta name="twitter:description" content="Compara tarifas de electricidad T2, T3 y gas RL1. Calcula tu ahorro mensual y anual.">
<meta name="twitter:image" content="https://comparadortarifasluzygas.livinkcoworking.es/favicon.svg">
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WV2PV3Z7');</script>
<!-- End Google Tag Manager -->
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;padding:20px}
.container{max-width:1600px;margin:0 auto;background:#fff;border-radius:20px;padding:30px;box-shadow:0 20px 60px rgba(0,0,0,.3)}
h1{text-align:center;color:#333;margin-bottom:10px;font-size:2em}
.subtitle{text-align:center;color:#666;margin-bottom:30px;font-size:.9em}
.info-text{background:#fff3cd;border:1px solid #ffc107;border-radius:8px;padding:12px;margin-bottom:20px;color:#856404;font-size:.9em}
.mode-toggle{display:flex;justify-content:center;gap:0;margin-bottom:30px;background:#f0f0f0;padding:5px;border-radius:12px;max-width:500px;margin:0 auto 30px}
.mode-btn{flex:1;padding:12px 20px;border:none;background:transparent;cursor:pointer;font-weight:600;font-size:1em;border-radius:8px;transition:all .3s;color:#666}
.mode-btn.active{background:#667eea;color:#fff;box-shadow:0 2px 8px rgba(102,126,234,.3)}
.mode-btn:hover:not(.active){background:#e0e0e0}
.consumo-mes-group{background:#e1f5fe;border:2px solid #0288d1;border-radius:10px;padding:15px;margin-bottom:20px}
.consumo-mes-group-title{color:#01579b;font-weight:700;font-size:1.1em;margin-bottom:15px;display:block}
.consumo-mes-group label{color:#01579b;font-weight:700;font-size:1em}
.consumo-tres-cols{display:grid;grid-template-columns:repeat(3,1fr);gap:15px}
.paste-info{background:#fff3cd;border-left:4px solid #ff9800;padding:12px;margin-bottom:15px;border-radius:4px;color:#856404;font-size:.9em}
.tabla-container{background:linear-gradient(135deg,#f3e5f5 0%,#e1bee7 100%);border:2px solid #9c27b0;border-radius:15px;padding:20px;margin-bottom:20px;overflow-x:auto;box-shadow:0 4px 12px rgba(156,39,176,.1)}
.tabla-meses{width:100%;border-collapse:collapse;margin-top:10px;background:#fff;min-width:1200px;border-radius:8px;overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.1)}
.tabla-meses th{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:8px 4px;font-weight:600;font-size:.85em;white-space:nowrap;border-right:1px solid rgba(255,255,255,.2)}
.tabla-meses th:last-child{border-right:none}
.tabla-meses td{padding:2px;border:1px solid #e0e0e0;text-align:center;transition:background .2s}
.tabla-meses tr:hover td{background:#f5f5f5}
.tabla-meses td:first-child{background:linear-gradient(135deg,#f5f5f5 0%,#eeeeee 100%);font-weight:600;text-align:left;white-space:nowrap;position:sticky;left:0;z-index:1;border-right:2px solid #9c27b0;padding:8px 10px}
.tabla-meses td:nth-child(2),.tabla-meses td:nth-child(3){position:sticky;left:70px;background:#f9f9f9;border-right:1px solid #ddd;z-index:1;min-width:90px}
.tabla-meses th:nth-child(2),.tabla-meses th:nth-child(3){position:sticky;left:70px;z-index:2}
.tabla-meses input{width:90px;text-align:center;border:1px solid #ddd;padding:6px 2px;border-radius:4px;font-size:1em;transition:border-color .3s,box-shadow .3s}
.tabla-meses input:focus{border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,.1);outline:none}
input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}
input[type=number]{-moz-appearance:textfield}
.tabla-actions{display:flex;gap:10px;margin-top:10px;flex-wrap:wrap}
.btn-tabla{padding:8px 16px;border:none;border-radius:8px;cursor:pointer;font-size:.9em;font-weight:500;transition:background .3s}
.btn-default{background:#9c27b0;color:#fff}
.btn-default:hover{background:#7b1fa2}
.btn-paste{background:#ff9800;color:#fff}
.btn-paste:hover{background:#f57c00}
.datos-usados{background:#f5f5f5;border:2px solid #9e9e9e;border-radius:10px;padding:20px;margin:30px 0}
.datos-usados h3{color:#424242;font-size:1.2em;margin-bottom:15px;text-align:center}
.datos-usados-grid{display:grid;grid-template-columns:1fr 1fr;gap:20px}
.datos-col h4{color:#666;font-size:1em;margin-bottom:10px;border-bottom:2px solid #ddd;padding-bottom:5px}
.datos-col p{margin:5px 0;color:#555;font-size:.9em}
.result-box{padding:25px;border-radius:12px;text-align:center;margin-top:20px}
.result-box.ahorro{background:linear-gradient(135deg,#4CAF50 0%,#45a049 100%);color:#fff;box-shadow:0 4px 15px rgba(76,175,80,.3)}
.result-box.no-ahorro{background:linear-gradient(135deg,#f44336 0%,#d32f2f 100%);color:#fff;box-shadow:0 4px 15px rgba(244,67,54,.3)}
.result-box h3{font-size:1.5em;margin-bottom:10px;font-weight:700}
.result-box .amount{font-size:2.5em;font-weight:700;margin:10px 0}
.result-box .message{font-size:1.2em;margin-top:10px;opacity:.95}
.tabs{display:flex;gap:10px;border-bottom:2px solid #e0e0e0;margin-bottom:30px}
.tab{padding:15px 30px;cursor:pointer;background:#f5f5f5;border:none;border-radius:10px 10px 0 0;font-size:1.1em;font-weight:600;color:#666;transition:all .3s;border-bottom:3px solid transparent}
.tab:hover{background:#e8e8e8}
.tab.active{background:#fff;color:#667eea;border-bottom:3px solid #667eea}
.tab-content{display:none}
.tab-content.active{display:block}
.offers-container{display:grid;grid-template-columns:1fr 1fr;gap:30px;margin-bottom:30px}
.offer-card{border:2px solid #e0e0e0;border-radius:15px;padding:25px;background:#fafafa}
.offer-card.nueva{border-color:#2196F3;background:#f0f7ff}
.offer-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.offer-title{font-size:1.5em;font-weight:700;color:#333}
.offer-card.nueva .offer-title{color:#2196F3}
.reset-btn{padding:8px 16px;background:#ff5722;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.9em;font-weight:500;transition:background .3s}
.reset-btn:hover{background:#e64a19}
.company-name{background:linear-gradient(135deg,#ff9800 0%,#f57c00 100%);border:2px solid #e65100;border-radius:12px;padding:20px;margin-bottom:25px}
.company-name label{color:#fff;font-weight:700;font-size:1.1em;display:block;margin-bottom:8px;text-shadow:1px 1px 2px rgba(0,0,0,.3)}
.company-name input{border:2px solid #fff;background:#fff;font-weight:600}
.form-group{margin-bottom:18px}
.discount-group{background:#e3f2fd;border:2px solid #2196F3;border-radius:10px;padding:15px;margin-bottom:20px}
.discount-group label{color:#1976D2;font-weight:700;font-size:1em}
.power-group{background:#fff3e0;border:2px solid #ff9800;border-radius:10px;padding:15px;margin-bottom:20px}
.power-group label{color:#e65100;font-weight:700;font-size:1em}
.power-group-title{color:#e65100;font-weight:700;font-size:1.1em;margin-bottom:15px;display:block}
.tabla-container .power-group-title{color:#7b1fa2;font-size:1.2em;margin-bottom:10px;text-align:center}
.energy-group{background:#e8f5e9;border:2px solid #4caf50;border-radius:10px;padding:15px;margin-bottom:20px}
.energy-group-title{color:#2e7d32;font-weight:700;font-size:1.1em;margin-bottom:15px;display:block}
.paste-group{background:#f3e5f5;border:2px solid #9c27b0;border-radius:10px;padding:15px;margin-bottom:20px}
.paste-group label{color:#7b1fa2;font-weight:700;font-size:1em;display:block;margin-bottom:8px}
.two-cols{display:grid;grid-template-columns:1fr 1fr;gap:15px}
.copy-btn{padding:6px 12px;background:#4caf50;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.85em;margin-top:10px;transition:background .3s}
.copy-btn:hover{background:#45a049}
label{display:block;margin-bottom:5px;color:#555;font-weight:500;font-size:.95em}
input[type=text],input[type=number],textarea,select{width:100%;padding:10px 12px;border:2px solid #ddd;border-radius:8px;font-size:1em;transition:border-color .3s;font-family:inherit}
input[type=text]:focus,input[type=number]:focus,textarea:focus,select:focus{outline:0;border-color:#667eea}
textarea{min-height:100px;resize:vertical}
.unit-selector{display:flex;gap:10px;margin-top:8px}
.unit-selector label{display:flex;align-items:center;gap:5px;font-weight:400;cursor:pointer}
input[type=radio]{cursor:pointer}
.calculate-btn{width:100%;padding:15px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;border-radius:10px;font-size:1.1em;font-weight:700;cursor:pointer;margin-top:20px;transition:transform .2s}
.calculate-btn:hover{transform:translateY(-2px)}
.results{margin-top:40px;padding-top:30px;border-top:3px solid #e0e0e0}
.results-header{text-align:center;font-size:1.8em;font-weight:700;margin-bottom:25px;color:#333}
.summary{display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px}
.summary-card{padding:20px;border-radius:12px;text-align:center;background:linear-gradient(135deg,#9E9E9E 0%,#757575 100%);color:#fff}
.summary-card.nueva{background:linear-gradient(135deg,#2196F3 0%,#1976D2 100%)}
.summary-label{font-size:1.1em;margin-bottom:10px;opacity:.9}
.summary-amount{font-size:2.5em;font-weight:700}
.hidden{display:none}
.historico{margin-top:40px;padding-top:30px;border-top:3px solid #e0e0e0}
.historico-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.historico-title{font-size:1.8em;font-weight:700;color:#333}
.historico-actions{display:flex;gap:10px}
.btn-secondary{padding:10px 16px;background:#757575;color:#fff;border:none;border-radius:8px;cursor:pointer;font-size:.9em;font-weight:500;transition:background .3s}
.btn-secondary:hover{background:#616161}
.btn-danger{background:#f44336}
.btn-danger:hover{background:#d32f2f}
.historico-list{display:grid;gap:15px}
.historico-item{display:grid;grid-template-columns:2fr 1fr 1fr auto;gap:15px;align-items:center;padding:15px 20px;background:#f5f5f5;border-radius:10px;border-left:4px solid #2196F3}
.historico-nombre{font-weight:600;color:#333;font-size:1.1em}
.historico-total{text-align:center;font-size:1.2em;font-weight:700;color:#2196F3}
.historico-ahorro{text-align:center;font-size:1.2em;font-weight:700}
.historico-ahorro.positive{color:#4CAF50}
.historico-ahorro.negative{color:#f44336}
.historico-delete{padding:8px 12px;background:#f44336;color:#fff;border:none;border-radius:6px;cursor:pointer;font-size:.85em;transition:background .3s}
.historico-delete:hover{background:#d32f2f}
.historico-empty{text-align:center;padding:40px;color:#999;font-style:italic}
.file-input{display:none}
.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,.5)}
.modal.hidden{display:none}
.modal:not(.hidden){display:flex;align-items:center;justify-content:center}
.modal-content{background:#fff;border-radius:15px;max-width:600px;width:90%;box-shadow:0 10px 40px rgba(0,0,0,.3)}
.modal-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:20px;border-radius:15px 15px 0 0;display:flex;justify-content:space-between;align-items:center}
.modal-header h3{margin:0;font-size:1.3em}
.modal-close{background:transparent;border:none;color:#fff;font-size:1.5em;cursor:pointer;padding:0;width:30px;height:30px;line-height:1}
.modal-close:hover{opacity:.8}
.modal-body{padding:25px}
.modal-body p{margin-bottom:15px;color:#666;line-height:1.5}
.modal-body code{display:block;background:#f5f5f5;padding:10px;border-radius:4px;font-size:.85em;margin-top:8px;white-space:pre;overflow-x:auto}
.modal-body textarea{width:100%;min-height:150px;padding:12px;border:2px solid #ddd;border-radius:8px;font-family:monospace;font-size:.9em;resize:vertical}
.modal-body textarea:focus{outline:0;border-color:#667eea}
.modal-footer{padding:20px;display:flex;gap:10px;justify-content:flex-end;border-top:1px solid #e0e0e0}
small{display:block;margin-top:5px;color:#666;font-size:.85em}
.btn-comentarios{position:fixed;bottom:30px;right:30px;background:linear-gradient(135deg,#ff9800 0%,#f57c00 100%);color:#fff;border:none;border-radius:50px;width:60px;height:60px;font-size:1.5em;cursor:pointer;box-shadow:0 4px 12px rgba(255,152,0,.4);transition:all .3s;z-index:100;display:flex;align-items:center;justify-content:center;text-decoration:none}
.btn-comentarios:hover{transform:scale(1.1);box-shadow:0 6px 16px rgba(255,152,0,.5)}
@media(max-width:600px){.btn-comentarios{width:50px;height:50px;bottom:20px;right:20px;font-size:1.2em}}
</style>
<!-- Overtracking Pixel Code -->
<script defer src="https://cdn.overtracking.com/t/tCynxd07qwQDT1SyD/"></script>
<!-- End Overtracking Pixel Code -->
</head>
<body>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WV2PV3Z7"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<div class="container">
<h1>‚ö°üî• Comparador de Tarifas de Luz y Gas</h1>
<p class="subtitle">Comparador de tarifas de luz/electricidad T2, GAS RL1 y electricidad T3 m√°s de 15kw</p>
<div class="info-text">üìä Compara 1 mes o varios meses seg√∫n tus necesidades</div>

<div class="tabs">
<button class="tab active" onclick="cambiarTab('t2')">‚ö° ELECTRICIDAD T2</button>
<button class="tab" onclick="cambiarTab('gas')">üî• GAS RL1</button>
<button class="tab" onclick="cambiarTab('t3')">‚ö° ELECTRICIDAD T3</button>
</div>

<!-- TAB T2 -->
<div id="tab-t2" class="tab-content active">
<div class="mode-toggle">
<button class="mode-btn active" onclick="cambiarModo('t2','mes')">Comparar 1 mes/factura</button>
<button class="mode-btn" onclick="cambiarModo('t2','varios')">Comparar varios meses</button>
</div>

<!-- Consumo 1 mes -->
<div id="t2-consumo-mes" class="consumo-mes-group">
<span class="consumo-mes-group-title">üìä Consumo del mes a comparar</span>
<div class="consumo-tres-cols">
<div class="form-group"><label>Punta (kWh)</label><input type="number" id="t2-cons-punta" step="0.01" placeholder="50"></div>
<div class="form-group"><label>Llano (kWh)</label><input type="number" id="t2-cons-llano" step="0.01" placeholder="35"></div>
<div class="form-group"><label>Valle (kWh)</label><input type="number" id="t2-cons-valle" step="0.01" placeholder="50"></div>
</div>
<small>Si no conoces el consumo, dejar vac√≠o (se usar√°n valores por defecto)</small>
</div>

<!-- Tabla varios meses -->
<div id="t2-tabla-meses" class="tabla-container hidden">
<span class="power-group-title">üìä Consumos √∫ltimos 12 meses</span>
<div class="paste-info">üí° <strong>Para pegar desde Excel o Google Sheets:</strong> Selecciona las 3 filas de datos, c√≥pialas (Ctrl+C) y usa el bot√≥n "Pegar datos" de abajo.</div>
<table class="tabla-meses" id="t2-tabla">
<thead><tr><th></th><th>Mes 1</th><th>Mes 2</th><th>Mes 3</th><th>Mes 4</th><th>Mes 5</th><th>Mes 6</th><th>Mes 7</th><th>Mes 8</th><th>Mes 9</th><th>Mes 10</th><th>Mes 11</th><th>Mes 12</th></tr></thead>
<tbody>
<tr><td><strong>Punta (kWh)</strong></td><td><input type="number" id="t2-punta-0" step="0.01"></td><td><input type="number" id="t2-punta-1" step="0.01"></td><td><input type="number" id="t2-punta-2" step="0.01"></td><td><input type="number" id="t2-punta-3" step="0.01"></td><td><input type="number" id="t2-punta-4" step="0.01"></td><td><input type="number" id="t2-punta-5" step="0.01"></td><td><input type="number" id="t2-punta-6" step="0.01"></td><td><input type="number" id="t2-punta-7" step="0.01"></td><td><input type="number" id="t2-punta-8" step="0.01"></td><td><input type="number" id="t2-punta-9" step="0.01"></td><td><input type="number" id="t2-punta-10" step="0.01"></td><td><input type="number" id="t2-punta-11" step="0.01"></td></tr>
<tr><td><strong>Llano (kWh)</strong></td><td><input type="number" id="t2-llano-0" step="0.01"></td><td><input type="number" id="t2-llano-1" step="0.01"></td><td><input type="number" id="t2-llano-2" step="0.01"></td><td><input type="number" id="t2-llano-3" step="0.01"></td><td><input type="number" id="t2-llano-4" step="0.01"></td><td><input type="number" id="t2-llano-5" step="0.01"></td><td><input type="number" id="t2-llano-6" step="0.01"></td><td><input type="number" id="t2-llano-7" step="0.01"></td><td><input type="number" id="t2-llano-8" step="0.01"></td><td><input type="number" id="t2-llano-9" step="0.01"></td><td><input type="number" id="t2-llano-10" step="0.01"></td><td><input type="number" id="t2-llano-11" step="0.01"></td></tr>
<tr><td><strong>Valle (kWh)</strong></td><td><input type="number" id="t2-valle-0" step="0.01"></td><td><input type="number" id="t2-valle-1" step="0.01"></td><td><input type="number" id="t2-valle-2" step="0.01"></td><td><input type="number" id="t2-valle-3" step="0.01"></td><td><input type="number" id="t2-valle-4" step="0.01"></td><td><input type="number" id="t2-valle-5" step="0.01"></td><td><input type="number" id="t2-valle-6" step="0.01"></td><td><input type="number" id="t2-valle-7" step="0.01"></td><td><input type="number" id="t2-valle-8" step="0.01"></td><td><input type="number" id="t2-valle-9" step="0.01"></td><td><input type="number" id="t2-valle-10" step="0.01"></td><td><input type="number" id="t2-valle-11" step="0.01"></td></tr>
</tbody>
</table>
<div class="tabla-actions">
<button class="btn-tabla btn-default" onclick="usarDefaults('t2')">üìã Usar consumos por defecto</button>
<button class="btn-tabla btn-paste" onclick="abrirModalPaste('t2')">üì• Pegar datos</button>
<button class="btn-tabla" style="background:#4caf50;color:#fff" onclick="copiarTabla('t2')">üìã Copiar tabla</button>
<button class="btn-tabla" style="background:#1976d2;color:#fff" onclick="window.open('https://sheets.new/','_blank')">üìä Abrir Sheets</button>
</div>
</div>

<div class="offers-container">
<div class="offer-card">
<div class="offer-header"><div class="offer-title">üè† Oferta Actual</div></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="t2-actual-nombre" placeholder="Ej: Iberdrola">
</div>
<div class="power-group">
<span class="power-group-title">‚ö° Potencia instalada y coste en ‚Ç¨/kW</span>
<div class="two-cols">
<div>
<div class="form-group"><label>Potencia Punta (kW)</label><input type="number" id="t2-actual-pot-punta-kw" step="0.001" placeholder="Ej: 2.2"></div>
<div class="form-group"><label>Coste Punta</label><input type="number" id="t2-actual-pot-punta-precio" step="0.001" placeholder="Ej: 0.042">
<div class="unit-selector"><label><input type="radio" name="t2-actual-unit-punta" value="dia" checked> ‚Ç¨/kW/d√≠a</label><label><input type="radio" name="t2-actual-unit-punta" value="ano"> ‚Ç¨/kW/a√±o</label></div></div>
</div>
<div>
<div class="form-group"><label>Potencia Valle (kW)</label><input type="number" id="t2-actual-pot-valle-kw" step="0.001" placeholder="Ej: 6.6"></div>
<div class="form-group"><label>Coste Valle</label><input type="number" id="t2-actual-pot-valle-precio" step="0.001" placeholder="Ej: 0.018">
<div class="unit-selector"><label><input type="radio" name="t2-actual-unit-valle" value="dia" checked> ‚Ç¨/kW/d√≠a</label><label><input type="radio" name="t2-actual-unit-valle" value="ano"> ‚Ç¨/kW/a√±o</label></div></div>
</div>
</div>
</div>
<div class="energy-group">
<span class="energy-group-title">üí° Coste en ‚Ç¨/kWh de la energ√≠a consumida</span>
<div class="form-group"><label>Precio Punta (‚Ç¨/kWh)</label><input type="number" id="t2-actual-punta" step="0.001" placeholder="Ej: 0.15"></div>
<div class="form-group"><label>Precio Llano (‚Ç¨/kWh)</label><input type="number" id="t2-actual-llano" step="0.001" placeholder="Ej: 0.12"></div>
<div class="form-group"><label>Precio Valle (‚Ç¨/kWh)</label><input type="number" id="t2-actual-valle" step="0.001" placeholder="Ej: 0.08"></div>
<button class="copy-btn" onclick="copiarTarifaPlanaT2('actual')">üìã Copiar tarifa plana (mismo precio en los 3)</button>
</div>
<div class="discount-group">
<label>üí∞ Descuento Energ√≠a (%)</label>
<input type="number" id="t2-actual-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica a punta, llano y valle</small>
</div>
</div>
<div class="offer-card nueva">
<div class="offer-header"><div class="offer-title">‚ú® Oferta Nueva</div><button class="reset-btn" onclick="resetNuevaOferta()">üîÑ Limpiar</button></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="t2-nueva-nombre" placeholder="Ej: Endesa">
</div>
<div class="power-group">
<span class="power-group-title">‚ö° Potencia instalada y coste en ‚Ç¨/kW</span>
<div class="two-cols">
<div>
<div class="form-group"><label>Potencia Punta (kW)</label><input type="number" id="t2-nueva-pot-punta-kw" step="0.001" placeholder="Ej: 2.2"></div>
<div class="form-group"><label>Coste Punta</label><input type="number" id="t2-nueva-pot-punta-precio" step="0.001" placeholder="Ej: 0.040">
<div class="unit-selector"><label><input type="radio" name="t2-nueva-unit-punta" value="dia" checked> ‚Ç¨/kW/d√≠a</label><label><input type="radio" name="t2-nueva-unit-punta" value="ano"> ‚Ç¨/kW/a√±o</label></div></div>
</div>
<div>
<div class="form-group"><label>Potencia Valle (kW)</label><input type="number" id="t2-nueva-pot-valle-kw" step="0.001" placeholder="Ej: 6.6"></div>
<div class="form-group"><label>Coste Valle</label><input type="number" id="t2-nueva-pot-valle-precio" step="0.001" placeholder="Ej: 0.016">
<div class="unit-selector"><label><input type="radio" name="t2-nueva-unit-valle" value="dia" checked> ‚Ç¨/kW/d√≠a</label><label><input type="radio" name="t2-nueva-unit-valle" value="ano"> ‚Ç¨/kW/a√±o</label></div></div>
</div>
</div>
</div>
<div class="energy-group">
<span class="energy-group-title">üí° Coste en ‚Ç¨/kWh de la energ√≠a consumida</span>
<div class="form-group"><label>Precio Punta (‚Ç¨/kWh)</label><input type="number" id="t2-nueva-punta" step="0.001" placeholder="Ej: 0.14"></div>
<div class="form-group"><label>Precio Llano (‚Ç¨/kWh)</label><input type="number" id="t2-nueva-llano" step="0.001" placeholder="Ej: 0.11"></div>
<div class="form-group"><label>Precio Valle (‚Ç¨/kWh)</label><input type="number" id="t2-nueva-valle" step="0.001" placeholder="Ej: 0.07"></div>
<button class="copy-btn" onclick="copiarTarifaPlanaT2('nueva')">üìã Copiar tarifa plana (mismo precio en los 3)</button>
</div>
<div class="discount-group">
<label>üí∞ Descuento Energ√≠a (%)</label>
<input type="number" id="t2-nueva-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica a punta, llano y valle</small>
</div>
</div>
</div>
</div>

<!-- TAB GAS -->
<div id="tab-gas" class="tab-content">
<div class="mode-toggle">
<button class="mode-btn active" onclick="cambiarModo('gas','mes')">Comparar 1 mes/factura</button>
<button class="mode-btn" onclick="cambiarModo('gas','varios')">Comparar varios meses</button>
</div>

<!-- Consumo 1 mes -->
<div id="gas-consumo-mes" class="consumo-mes-group">
<span class="consumo-mes-group-title">üìä Consumo del mes a comparar</span>
<div class="consumo-tres-cols">
<div class="form-group"><label>Consumo (kWh)</label><input type="number" id="gas-cons" step="0.01" placeholder="1000"></div>
</div>
<small>Si no conoces el consumo, dejar vac√≠o (se usar√° valor por defecto)</small>
</div>

<!-- Tabla varios meses -->
<div id="gas-tabla-meses" class="tabla-container hidden">
<span class="power-group-title">üìä Consumos √∫ltimos 12 meses</span>
<div class="paste-info">üí° <strong>Para pegar desde Excel o Google Sheets:</strong> Selecciona la fila con los 12 valores, c√≥piala (Ctrl+C) y usa el bot√≥n "Pegar datos".</div>
<table class="tabla-meses" id="gas-tabla">
<thead><tr><th></th><th>Mes 1</th><th>Mes 2</th><th>Mes 3</th><th>Mes 4</th><th>Mes 5</th><th>Mes 6</th><th>Mes 7</th><th>Mes 8</th><th>Mes 9</th><th>Mes 10</th><th>Mes 11</th><th>Mes 12</th></tr></thead>
<tbody>
<tr><td><strong>Consumo (kWh)</strong></td><td><input type="number" id="gas-kwh-0" step="0.01"></td><td><input type="number" id="gas-kwh-1" step="0.01"></td><td><input type="number" id="gas-kwh-2" step="0.01"></td><td><input type="number" id="gas-kwh-3" step="0.01"></td><td><input type="number" id="gas-kwh-4" step="0.01"></td><td><input type="number" id="gas-kwh-5" step="0.01"></td><td><input type="number" id="gas-kwh-6" step="0.01"></td><td><input type="number" id="gas-kwh-7" step="0.01"></td><td><input type="number" id="gas-kwh-8" step="0.01"></td><td><input type="number" id="gas-kwh-9" step="0.01"></td><td><input type="number" id="gas-kwh-10" step="0.01"></td><td><input type="number" id="gas-kwh-11" step="0.01"></td></tr>
</tbody>
</table>
<div class="tabla-actions">
<button class="btn-tabla btn-default" onclick="usarDefaults('gas')">üìã Usar consumos por defecto</button>
<button class="btn-tabla btn-paste" onclick="abrirModalPaste('gas')">üì• Pegar datos</button>
<button class="btn-tabla" style="background:#4caf50;color:#fff" onclick="copiarTabla('gas')">üìã Copiar tabla</button>
<button class="btn-tabla" style="background:#1976d2;color:#fff" onclick="window.open('https://sheets.new/','_blank')">üìä Abrir Sheets</button>
</div>
</div>

<div class="offers-container">
<div class="offer-card">
<div class="offer-header"><div class="offer-title">üè† Oferta Actual</div></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="gas-actual-nombre" placeholder="Ej: Naturgy">
</div>
<div class="form-group"><label>T√©rmino Fijo</label><input type="number" id="gas-actual-fijo" step="0.001" placeholder="Ej: 0.35">
<div class="unit-selector"><label><input type="radio" name="gas-actual-unit" value="dia" checked> ‚Ç¨/d√≠a</label><label><input type="radio" name="gas-actual-unit" value="mes"> ‚Ç¨/mes</label></div></div>
<div class="form-group"><label>T√©rmino Variable (‚Ç¨/kWh)</label><input type="number" id="gas-actual-variable" step="0.001" placeholder="Ej: 0.05"></div>
<div class="discount-group">
<label>üí∞ Descuento Consumo (%)</label>
<input type="number" id="gas-actual-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica al t√©rmino variable</small>
</div>
</div>

<div class="offer-card nueva">
<div class="offer-header"><div class="offer-title">‚ú® Oferta Nueva</div></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="gas-nueva-nombre" placeholder="Ej: Repsol">
</div>
<div class="form-group"><label>T√©rmino Fijo</label><input type="number" id="gas-nueva-fijo" step="0.001" placeholder="Ej: 0.30">
<div class="unit-selector"><label><input type="radio" name="gas-nueva-unit" value="dia" checked> ‚Ç¨/d√≠a</label><label><input type="radio" name="gas-nueva-unit" value="mes"> ‚Ç¨/mes</label></div></div>
<div class="form-group"><label>T√©rmino Variable (‚Ç¨/kWh)</label><input type="number" id="gas-nueva-variable" step="0.001" placeholder="Ej: 0.045"></div>
<div class="discount-group">
<label>üí∞ Descuento Consumo (%)</label>
<input type="number" id="gas-nueva-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica al t√©rmino variable</small>
</div>
</div>
</div>
</div>

<!-- TAB T3 -->
<div id="tab-t3" class="tab-content">
<div class="mode-toggle">
<button class="mode-btn active" onclick="cambiarModo('t3','mes')">Comparar 1 mes/factura</button>
<button class="mode-btn" onclick="cambiarModo('t3','varios')">Comparar varios meses</button>
</div>

<!-- Modo un mes -->
<div id="t3-modo-mes">
<div class="info-text">üìå T3: Comparaci√≥n por mes seleccionado. Elige tu mes de mayor consumo para mejor estimaci√≥n.</div>
<div class="form-group" style="max-width:300px;margin:0 auto 20px">
<label>üìÖ Mes de Comparaci√≥n</label>
<select id="t3-mes">
<option value="0">Enero</option>
<option value="1">Febrero</option>
<option value="2">Marzo</option>
<option value="3">Abril</option>
<option value="4">Mayo</option>
<option value="5">Junio</option>
<option value="6">Julio</option>
<option value="7">Agosto</option>
<option value="8">Septiembre</option>
<option value="9">Octubre</option>
<option value="10">Noviembre</option>
<option value="11">Diciembre</option>
</select>
</div>
<div class="offers-container">
<div class="offer-card">
<div class="offer-header"><div class="offer-title">üè† Oferta Actual</div></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="t3-actual-nombre" placeholder="Ej: Mi compa√±√≠a">
</div>
<div class="paste-group">
<label>üìã Pega Potencias de tu Factura (P1-P6)</label>
<textarea id="t3-actual-potencias" placeholder="Pega aqu√≠:
Periodo P1 (01/12/2024 - 31/12/2024): 13,5000 kW * 0,042931 ‚Ç¨/kW d√≠a * 31 d√≠as 17,97 ‚Ç¨
Periodo P2 (01/12/2024 - 31/12/2024): 16,4540 kW * 0,026084 ‚Ç¨/kW d√≠a * 31 d√≠as 13,30 ‚Ç¨
..."></textarea>
<small>Se extraer√° kW y ‚Ç¨/kW/d√≠a para P1-P6</small>
</div>
<div class="paste-group">
<label>üìã Pega Precios Energ√≠a de tu Factura (P1-P6)</label>
<textarea id="t3-actual-energia" placeholder="Pega aqu√≠ los precios de energ√≠a:
Precio P1: 0,150 ‚Ç¨/kWh
Precio P2: 0,140 ‚Ç¨/kWh
..."></textarea>
<small>Se extraer√° precio en ‚Ç¨/kWh para P1-P6</small>
</div>
<div class="discount-group">
<label>üí∞ Descuento Energ√≠a (%)</label>
<input type="number" id="t3-actual-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica a todos los precios de energ√≠a</small>
</div>
</div>
<div class="offer-card nueva">
<div class="offer-header"><div class="offer-title">‚ú® Oferta Nueva</div></div>
<div class="company-name">
<label>üè¢ Nombre de la Compa√±√≠a</label>
<input type="text" id="t3-nueva-nombre" placeholder="Ej: Oferta T3">
</div>
<div class="paste-group">
<label>üìã Pega Potencias de la Oferta (P1-P6)</label>
<textarea id="t3-nueva-potencias" placeholder="Pega aqu√≠ los datos de potencia..."></textarea>
<small>Se extraer√° kW y ‚Ç¨/kW/d√≠a para P1-P6</small>
</div>
<div class="paste-group">
<label>üìã Pega Precios Energ√≠a de la Oferta (P1-P6)</label>
<textarea id="t3-nueva-energia" placeholder="Pega aqu√≠ los precios de energ√≠a..."></textarea>
<small>Se extraer√° precio en ‚Ç¨/kWh para P1-P6</small>
</div>
<div class="discount-group">
<label>üí∞ Descuento Energ√≠a (%)</label>
<input type="number" id="t3-nueva-dto" step="0.1" placeholder="0" value="0">
<small style="color:#1976D2">Se aplica a todos los precios de energ√≠a</small>
</div>
</div>
</div>
</div>

<!-- Modo varios meses -->
<div id="t3-modo-varios" class="hidden">
<div class="paste-info">üí° Introduce las potencias y precios fijos una sola vez. Los consumos (kWh) var√≠an mensualmente.</div>
<div class="tabla-container">
<span class="power-group-title">üìä Consumos T3 - √öltimos 12 meses</span>
<table class="tabla-meses" id="t3-tabla">
<thead><tr><th>Periodo</th><th>kW</th><th>‚Ç¨/kW/d√≠a</th><th>Mes 1</th><th>Mes 2</th><th>Mes 3</th><th>Mes 4</th><th>Mes 5</th><th>Mes 6</th><th>Mes 7</th><th>Mes 8</th><th>Mes 9</th><th>Mes 10</th><th>Mes 11</th><th>Mes 12</th><th>‚Ç¨/kWh</th></tr></thead>
<tbody>
<tr><td><strong>P1</strong></td><td><input type="number" id="t3-p1-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p1-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p1-kwh-0" step="0.01"></td><td><input type="number" id="t3-p1-kwh-1" step="0.01"></td><td><input type="number" id="t3-p1-kwh-2" step="0.01"></td><td><input type="number" id="t3-p1-kwh-3" step="0.01"></td><td><input type="number" id="t3-p1-kwh-4" step="0.01"></td><td><input type="number" id="t3-p1-kwh-5" step="0.01"></td><td><input type="number" id="t3-p1-kwh-6" step="0.01"></td><td><input type="number" id="t3-p1-kwh-7" step="0.01"></td><td><input type="number" id="t3-p1-kwh-8" step="0.01"></td><td><input type="number" id="t3-p1-kwh-9" step="0.01"></td><td><input type="number" id="t3-p1-kwh-10" step="0.01"></td><td><input type="number" id="t3-p1-kwh-11" step="0.01"></td><td><input type="number" id="t3-p1-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
<tr><td><strong>P2</strong></td><td><input type="number" id="t3-p2-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p2-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p2-kwh-0" step="0.01"></td><td><input type="number" id="t3-p2-kwh-1" step="0.01"></td><td><input type="number" id="t3-p2-kwh-2" step="0.01"></td><td><input type="number" id="t3-p2-kwh-3" step="0.01"></td><td><input type="number" id="t3-p2-kwh-4" step="0.01"></td><td><input type="number" id="t3-p2-kwh-5" step="0.01"></td><td><input type="number" id="t3-p2-kwh-6" step="0.01"></td><td><input type="number" id="t3-p2-kwh-7" step="0.01"></td><td><input type="number" id="t3-p2-kwh-8" step="0.01"></td><td><input type="number" id="t3-p2-kwh-9" step="0.01"></td><td><input type="number" id="t3-p2-kwh-10" step="0.01"></td><td><input type="number" id="t3-p2-kwh-11" step="0.01"></td><td><input type="number" id="t3-p2-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
<tr><td><strong>P3</strong></td><td><input type="number" id="t3-p3-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p3-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p3-kwh-0" step="0.01"></td><td><input type="number" id="t3-p3-kwh-1" step="0.01"></td><td><input type="number" id="t3-p3-kwh-2" step="0.01"></td><td><input type="number" id="t3-p3-kwh-3" step="0.01"></td><td><input type="number" id="t3-p3-kwh-4" step="0.01"></td><td><input type="number" id="t3-p3-kwh-5" step="0.01"></td><td><input type="number" id="t3-p3-kwh-6" step="0.01"></td><td><input type="number" id="t3-p3-kwh-7" step="0.01"></td><td><input type="number" id="t3-p3-kwh-8" step="0.01"></td><td><input type="number" id="t3-p3-kwh-9" step="0.01"></td><td><input type="number" id="t3-p3-kwh-10" step="0.01"></td><td><input type="number" id="t3-p3-kwh-11" step="0.01"></td><td><input type="number" id="t3-p3-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
<tr><td><strong>P4</strong></td><td><input type="number" id="t3-p4-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p4-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p4-kwh-0" step="0.01"></td><td><input type="number" id="t3-p4-kwh-1" step="0.01"></td><td><input type="number" id="t3-p4-kwh-2" step="0.01"></td><td><input type="number" id="t3-p4-kwh-3" step="0.01"></td><td><input type="number" id="t3-p4-kwh-4" step="0.01"></td><td><input type="number" id="t3-p4-kwh-5" step="0.01"></td><td><input type="number" id="t3-p4-kwh-6" step="0.01"></td><td><input type="number" id="t3-p4-kwh-7" step="0.01"></td><td><input type="number" id="t3-p4-kwh-8" step="0.01"></td><td><input type="number" id="t3-p4-kwh-9" step="0.01"></td><td><input type="number" id="t3-p4-kwh-10" step="0.01"></td><td><input type="number" id="t3-p4-kwh-11" step="0.01"></td><td><input type="number" id="t3-p4-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
<tr><td><strong>P5</strong></td><td><input type="number" id="t3-p5-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p5-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p5-kwh-0" step="0.01"></td><td><input type="number" id="t3-p5-kwh-1" step="0.01"></td><td><input type="number" id="t3-p5-kwh-2" step="0.01"></td><td><input type="number" id="t3-p5-kwh-3" step="0.01"></td><td><input type="number" id="t3-p5-kwh-4" step="0.01"></td><td><input type="number" id="t3-p5-kwh-5" step="0.01"></td><td><input type="number" id="t3-p5-kwh-6" step="0.01"></td><td><input type="number" id="t3-p5-kwh-7" step="0.01"></td><td><input type="number" id="t3-p5-kwh-8" step="0.01"></td><td><input type="number" id="t3-p5-kwh-9" step="0.01"></td><td><input type="number" id="t3-p5-kwh-10" step="0.01"></td><td><input type="number" id="t3-p5-kwh-11" step="0.01"></td><td><input type="number" id="t3-p5-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
<tr><td><strong>P6</strong></td><td><input type="number" id="t3-p6-kw" step="0.01" placeholder="kW"></td><td><input type="number" id="t3-p6-precio-kw" step="0.001" placeholder="‚Ç¨/kW/d√≠a"></td><td><input type="number" id="t3-p6-kwh-0" step="0.01"></td><td><input type="number" id="t3-p6-kwh-1" step="0.01"></td><td><input type="number" id="t3-p6-kwh-2" step="0.01"></td><td><input type="number" id="t3-p6-kwh-3" step="0.01"></td><td><input type="number" id="t3-p6-kwh-4" step="0.01"></td><td><input type="number" id="t3-p6-kwh-5" step="0.01"></td><td><input type="number" id="t3-p6-kwh-6" step="0.01"></td><td><input type="number" id="t3-p6-kwh-7" step="0.01"></td><td><input type="number" id="t3-p6-kwh-8" step="0.01"></td><td><input type="number" id="t3-p6-kwh-9" step="0.01"></td><td><input type="number" id="t3-p6-kwh-10" step="0.01"></td><td><input type="number" id="t3-p6-kwh-11" step="0.01"></td><td><input type="number" id="t3-p6-energia" step="0.001" placeholder="‚Ç¨/kWh"></td></tr>
</tbody>
</table>
<div class="tabla-actions">
<button class="btn-tabla btn-default" onclick="copiarTabla('t3')">üìã Copiar tabla</button>
<button class="btn-tabla" style="background:#1976d2;color:#fff" onclick="window.open('https://sheets.new/','_blank')">üìä Abrir Sheets</button>
</div>
</div>
</div>
</div>

<button class="calculate-btn" onclick="calcular()">üìä CALCULAR Y COMPARAR</button>

<div id="results" class="results hidden"></div>
<div id="historico" class="historico hidden">
<div class="historico-header">
<div class="historico-title">üìú Hist√≥rico</div>
<div class="historico-actions">
<button class="btn-secondary" onclick="exportarHistorico()">üì• Exportar</button>
<button class="btn-secondary" onclick="document.getElementById('importFile').click()">üì§ Importar</button>
<button class="btn-secondary btn-danger" onclick="limpiarHistorico()">üóëÔ∏è Limpiar</button>
</div>
</div>
<div id="historico-list" class="historico-list"><div class="historico-empty">No hay ofertas guardadas</div></div>
</div>
</div>

<!-- Modal para pegar datos -->
<div id="modalPaste" class="modal hidden">
<div class="modal-content">
<div class="modal-header">
<h3 id="modalTitle">üì• Pegar datos desde Excel/Sheets</h3>
<button class="modal-close" onclick="cerrarModal()">‚úï</button>
</div>
<div class="modal-body">
<p id="modalInstrucciones"></p>
<textarea id="modalTextarea" placeholder="Pega aqu√≠ los datos (Ctrl+V)"></textarea>
</div>
<div class="modal-footer">
<button class="btn-secondary" onclick="cerrarModal()">Cancelar</button>
<button class="btn-tabla btn-paste" onclick="aplicarPaste()">‚úÖ Aplicar datos</button>
</div>
</div>
</div>

<input type="file" id="importFile" class="file-input" accept=".json" onchange="importarHistorico(event)">

<!-- Bot√≥n flotante para comentarios -->
<button id="btnComentarios" class="btn-comentarios" onclick="abrirFormularioComentarios()" title="Enviar comentarios o reportar errores">üí¨ Comentarios</button>

<!-- Modal de comentarios -->
<div id="modalComentarios" class="modal hidden">
<div class="modal-content">
<div class="modal-header">
<h3>üí¨ Comentarios y Errores</h3>
<button class="modal-close" onclick="cerrarModalComentarios()">‚úï</button>
</div>
<div class="modal-body">
<p>¬øEncontraste un error o tienes sugerencias? Cu√©ntanos.</p>
<form id="formComentarios">
<div class="form-group"><label>Nombre (opcional)</label><input type="text" id="nombre-comentario" placeholder="Tu nombre"></div>
<div class="form-group"><label>Email (opcional)</label><input type="email" id="email-comentario" placeholder="tu@email.com"></div>
<div class="form-group"><label>Mensaje *</label><textarea id="mensaje-comentario" placeholder="Describe el error o tu sugerencia" required></textarea></div>
<div class="form-group"><label><input type="checkbox" id="tipo-error"> Es un error / bug</label></div>
</form>
</div>
<div class="modal-footer">
<button class="btn-secondary" onclick="cerrarModalComentarios()">Cancelar</button>
<button class="btn-tabla btn-paste" onclick="enviarComentarioGoogle()">‚úÖ Enviar</button>
</div>
</div>
</div>

<!-- Google Analytics Placeholder -->
<!-- REEMPLAZA 'G-XXXXXXXXXX' CON TU MEASUREMENT ID -->
<!-- <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-XXXXXXXXXX');
</script> -->

<script>
const consumosT2Default={meses:['Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre','Enero','Febrero'],dias:[31,30,31,30,31,30,31,30,31,30,31,28],punta:[54,75,55,24,13,28,14,26,24,26,30,40],llano:[38,54,44,22,15,25,16,25,20,27,25,35],valle:[54,69,67,35,25,35,26,29,33,39,40,50]};
const consumosGasDefault={meses:['Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre','Enero'],dias:[28,31,30,31,30,31,31,30,31,30,31,31],kwh:[35,700,340,300,120,100,35,90,340,500,910,800]};
const diasMes=[31,28,31,30,31,30,31,31,30,31,30,31];

let tabActual='t2';
let modoT2='mes';
let modoGas='mes';
let modoT3='mes';

window.addEventListener('DOMContentLoaded',()=>{cargarDatos();mostrarHistorico();actualizarHeadersMeses()});

let tipoActualPaste='';

function generarMesesDinamicos(){
const ahora=new Date();
const meses=['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'];
const resultado=[];
for(let i=11;i>=0;i--){
const fecha=new Date(ahora.getFullYear(),ahora.getMonth()-i,1);
const mesIndex=fecha.getMonth();
const a√±o=fecha.getFullYear();
resultado.push({nombre:meses[mesIndex],numero:mesIndex,a√±o:a√±o,display:`${meses[mesIndex]} ${a√±o}`});
}
return resultado;
}

function actualizarHeadersMeses(){
const mesesDin=generarMesesDinamicos();
const headersT2=document.querySelectorAll('#t2-tabla-meses thead th');
const headersGas=document.querySelectorAll('#gas-tabla-meses thead th');
mesesDin.forEach((mes,idx)=>{
if(headersT2[idx+1])headersT2[idx+1].textContent=mes.display;
if(headersGas[idx+1])headersGas[idx+1].textContent=mes.display;
});
}

function copiarTabla(tipo){
let contenido='';
if(tipo==='t2'){
const headers=['','Punta (kWh)','Llano (kWh)','Valle (kWh)'];
const meses=generarMesesDinamicos();
contenido=headers.join('\t')+'\n';
meses.forEach(mes=>contenido+=mes.display+'\t\t\t\n');
contenido+='\n'+meses.forEach(mes=>'').join('\t');
}else if(tipo==='gas'){
const meses=generarMesesDinamicos();
contenido='Mes\tConsumo (kWh)\n';
meses.forEach(mes=>contenido+=mes.display+'\t\n');
}else if(tipo==='t3'){
const meses=generarMesesDinamicos();
contenido='Periodo\tkW\t‚Ç¨/kW/d√≠a\t'+meses.map(m=>m.display).join('\t')+'\t‚Ç¨/kWh\n';
['P1','P2','P3','P4','P5','P6'].forEach(p=>contenido+=p+'\t\t\t'+meses.map(m=>'').join('\t')+'\t\n');
}
navigator.clipboard.writeText(contenido).then(()=>alert('‚úÖ Tabla copiada')).catch(()=>alert('‚ùå Error al copiar'));
}

function abrirModalPaste(tipo){
tipoActualPaste=tipo;
const modal=document.getElementById('modalPaste');
const titulo=document.getElementById('modalTitle');
const instrucciones=document.getElementById('modalInstrucciones');
const textarea=document.getElementById('modalTextarea');

if(tipo==='t2'){
titulo.textContent='üì• Pegar datos T2 - Electricidad';
instrucciones.innerHTML='<strong>Instrucciones:</strong> En Excel/Sheets, selecciona las <strong>3 filas</strong> de datos (Punta, Llano, Valle) con sus 12 valores, c√≥pialas (Ctrl+C) y p√©galas aqu√≠ abajo (Ctrl+V).<br><br><strong>Ejemplo:</strong><br><code>54  75  55  24  13  28  14  26  24  26  30  40<br>38  54  44  22  15  25  16  25  20  27  25  35<br>54  69  67  35  25  35  26  29  33  39  40  50</code>';
}else{
titulo.textContent='üì• Pegar datos GAS';
instrucciones.innerHTML='<strong>Instrucciones:</strong> En Excel/Sheets, selecciona la <strong>1 fila</strong> con los 12 valores de consumo, c√≥piala (Ctrl+C) y p√©gala aqu√≠ abajo (Ctrl+V).<br><br><strong>Ejemplo:</strong><br><code>35  700  340  300  120  100  35  90  340  500  910  800</code>';
}
textarea.value='';
modal.classList.remove('hidden');
textarea.focus();
}

function cerrarModal(){
document.getElementById('modalPaste').classList.add('hidden');
}

function abrirFormularioComentarios(){
document.getElementById('modalComentarios').classList.remove('hidden');
document.getElementById('mensaje-comentario').focus();
}

function cerrarModalComentarios(){
document.getElementById('modalComentarios').classList.add('hidden');
document.getElementById('formComentarios').reset();
}

function enviarComentarioGoogle(){
const nombre=document.getElementById('nombre-comentario').value||'An√≥nimo';
const email=document.getElementById('email-comentario').value||'No proporcionado';
const mensaje=document.getElementById('mensaje-comentario').value;
const esError=document.getElementById('tipo-error').checked?'S√ç':'NO';

if(!mensaje.trim()){alert('‚ö†Ô∏è El mensaje es obligatorio');return}

const googleFormURL='https://docs.google.com/forms/d/e/REEMPLAZA_CON_TU_FORM_ID/formResponse';
const data=new FormData();
data.append('entry.XXXXXXXXX',nombre);
data.append('entry.YYYYYYYYY',email);
data.append('entry.ZZZZZZZZZ',mensaje);
data.append('entry.WWWWWWWWW',esError);

fetch(googleFormURL,{method:'POST',body:data,mode:'no-cors'}).then(()=>{
alert('‚úÖ Comentario enviado. ¬°Gracias!');
cerrarModalComentarios();
}).catch(()=>{
alert('‚ö†Ô∏è Error al enviar. Intenta de nuevo.');
});
}

function aplicarPaste(){
const texto=document.getElementById('modalTextarea').value;
if(!texto.trim()){
alert('‚ö†Ô∏è No has pegado ning√∫n dato');
return;
}
procesarPaste(tipoActualPaste,texto);
cerrarModal();
}

function procesarPaste(tipo,texto){
const lineas=texto.trim().split('\n');
if(tipo==='t2'){
if(lineas.length>=3){
const puntaVals=lineas[0].split(/[\t ]+/);
const llanoVals=lineas[1].split(/[\t ]+/);
const valleVals=lineas[2].split(/[\t ]+/);
let pegados=0;
for(let i=0;i<12;i++){
if(i<puntaVals.length){
const val=parseFloat(puntaVals[i].replace(',','.'));
if(!isNaN(val)){
document.getElementById(`t2-punta-${i}`).value=val;
pegados++;
}
}
if(i<llanoVals.length){
const val=parseFloat(llanoVals[i].replace(',','.'));
if(!isNaN(val)){
document.getElementById(`t2-llano-${i}`).value=val;
pegados++;
}
}
if(i<valleVals.length){
const val=parseFloat(valleVals[i].replace(',','.'));
if(!isNaN(val)){
document.getElementById(`t2-valle-${i}`).value=val;
pegados++;
}
}
}
if(pegados>0){
alert(`‚úÖ Datos pegados correctamente: ${pegados} valores`);
}else{
alert('‚ö†Ô∏è No se encontraron valores num√©ricos');
}
}else if(lineas.length===1){
const vals=lineas[0].split(/[\t ]+/);
let pegados=0;
for(let i=0;i<12&&i<vals.length;i++){
const val=parseFloat(vals[i].replace(',','.'));
if(!isNaN(val)){
document.getElementById(`t2-punta-${i}`).value=val;
pegados++;
}
}
if(pegados>0){
alert(`‚úÖ Pegados ${pegados} valores en fila Punta`);
}
}else{
alert(`‚ö†Ô∏è Se esperan 3 filas. Recibidas: ${lineas.length} filas`);
}
}else{
const valores=lineas[0].split(/[\t ]+/);
let pegados=0;
for(let i=0;i<12&&i<valores.length;i++){
const val=parseFloat(valores[i].replace(',','.'));
if(!isNaN(val)){
document.getElementById(`gas-kwh-${i}`).value=val;
pegados++;
}
}
if(pegados>0){
alert(`‚úÖ Datos pegados correctamente: ${pegados} valores`);
}else{
alert('‚ö†Ô∏è No se encontraron valores num√©ricos');
}
}
}

function cambiarTab(tab){
tabActual=tab;
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));
const tabs=['t2','gas','t3'];
const idx=tabs.indexOf(tab);
document.querySelectorAll('.tab')[idx].classList.add('active');
document.getElementById('tab-'+tab).classList.add('active');
}

function cambiarModo(tipo,modo){
if(tipo==='t2'){
modoT2=modo;
document.querySelectorAll('#tab-t2 .mode-btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
if(modo==='mes'){
document.getElementById('t2-consumo-mes').classList.remove('hidden');
document.getElementById('t2-tabla-meses').classList.add('hidden');
}else{
document.getElementById('t2-consumo-mes').classList.add('hidden');
document.getElementById('t2-tabla-meses').classList.remove('hidden');
}
}else if(tipo==='gas'){
modoGas=modo;
document.querySelectorAll('#tab-gas .mode-btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
if(modo==='mes'){
document.getElementById('gas-consumo-mes').classList.remove('hidden');
document.getElementById('gas-tabla-meses').classList.add('hidden');
}else{
document.getElementById('gas-consumo-mes').classList.add('hidden');
document.getElementById('gas-tabla-meses').classList.remove('hidden');
}
}else if(tipo==='t3'){
modoT3=modo;
document.querySelectorAll('#tab-t3 .mode-btn').forEach(b=>b.classList.remove('active'));
event.target.classList.add('active');
if(modo==='mes'){
document.getElementById('t3-modo-mes').classList.remove('hidden');
document.getElementById('t3-modo-varios').classList.add('hidden');
}else{
document.getElementById('t3-modo-mes').classList.add('hidden');
document.getElementById('t3-modo-varios').classList.remove('hidden');
}
}
}

function usarDefaults(tipo){
if(tipo==='t2'){
for(let i=0;i<12;i++){
document.getElementById(`t2-punta-${i}`).value=consumosT2Default.punta[i];
document.getElementById(`t2-llano-${i}`).value=consumosT2Default.llano[i];
document.getElementById(`t2-valle-${i}`).value=consumosT2Default.valle[i];
}
}else{
for(let i=0;i<12;i++){
document.getElementById(`gas-kwh-${i}`).value=consumosGasDefault.kwh[i];
}
}
}

function aplicarDescuento(precio,dto){return precio*(1-dto/100)}

function parsePotencias(texto){
const potencias={};
const regex=/Periodo\s+P(\d)\s*[^:]*:\s*([\d,]+)\s*kW\s*\*\s*([\d,]+)\s*‚Ç¨\/kW\s*d√≠a/gi;
let match;
while((match=regex.exec(texto))!==null){
const p='P'+match[1];
potencias[p]={kw:parseFloat(match[2].replace(',','.')),precio:parseFloat(match[3].replace(',','.'))};
}
return potencias;
}

function parseEnergia(texto){
const precios={};
const regex=/P(?:recio\s+)?P(\d)[^\d]*([\d,]+)\s*‚Ç¨\/kWh/gi;
let match;
while((match=regex.exec(texto))!==null){
const p='P'+match[1];
precios[p]=parseFloat(match[2].replace(',','.'));
}
return precios;
}

function copiarTarifaPlanaT2(tipo){
const precio=parseFloat(document.getElementById(`t2-${tipo}-punta`).value);
if(isNaN(precio)){alert('‚ö†Ô∏è Introduce primero el precio punta');return}
document.getElementById(`t2-${tipo}-llano`).value=precio;
document.getElementById(`t2-${tipo}-valle`).value=precio;
}

function cargarDatos(){
const d=localStorage.getItem('ofertaActual');
if(!d)return;
const datos=JSON.parse(d);
if(datos.t2){
document.getElementById('t2-actual-nombre').value=datos.t2.nombre||'';
document.getElementById('t2-actual-pot-punta-kw').value=datos.t2.potPuntaKw||'';
document.getElementById('t2-actual-pot-punta-precio').value=datos.t2.potPuntaPrecio||'';
document.getElementById('t2-actual-pot-valle-kw').value=datos.t2.potValleKw||'';
document.getElementById('t2-actual-pot-valle-precio').value=datos.t2.potVallePrecio||'';
document.getElementById('t2-actual-punta').value=datos.t2.punta||'';
document.getElementById('t2-actual-llano').value=datos.t2.llano||'';
document.getElementById('t2-actual-valle').value=datos.t2.valle||'';
document.getElementById('t2-actual-dto').value=datos.t2.dto||'0';
if(datos.t2.unitPunta)document.querySelector(`input[name="t2-actual-unit-punta"][value="${datos.t2.unitPunta}"]`).checked=true;
if(datos.t2.unitValle)document.querySelector(`input[name="t2-actual-unit-valle"][value="${datos.t2.unitValle}"]`).checked=true;
}
if(datos.gas){
document.getElementById('gas-actual-nombre').value=datos.gas.nombre||'';
document.getElementById('gas-actual-fijo').value=datos.gas.fijo||'';
document.getElementById('gas-actual-variable').value=datos.gas.variable||'';
document.getElementById('gas-actual-dto').value=datos.gas.dto||'0';
if(datos.gas.unit)document.querySelector(`input[name="gas-actual-unit"][value="${datos.gas.unit}"]`).checked=true;
}
if(datos.t3){
document.getElementById('t3-actual-nombre').value=datos.t3.nombre||'';
document.getElementById('t3-actual-potencias').value=datos.t3.potencias||'';
document.getElementById('t3-actual-energia').value=datos.t3.energia||'';
document.getElementById('t3-actual-dto').value=datos.t3.dto||'0';
}
}

function guardarDatos(){
const datos={
t2:{
nombre:document.getElementById('t2-actual-nombre').value,
potPuntaKw:document.getElementById('t2-actual-pot-punta-kw').value,
potPuntaPrecio:document.getElementById('t2-actual-pot-punta-precio').value,
potValleKw:document.getElementById('t2-actual-pot-valle-kw').value,
potVallePrecio:document.getElementById('t2-actual-pot-valle-precio').value,
punta:document.getElementById('t2-actual-punta').value,
llano:document.getElementById('t2-actual-llano').value,
valle:document.getElementById('t2-actual-valle').value,
dto:document.getElementById('t2-actual-dto').value,
unitPunta:document.querySelector('input[name="t2-actual-unit-punta"]:checked').value,
unitValle:document.querySelector('input[name="t2-actual-unit-valle"]:checked').value
},
gas:{
nombre:document.getElementById('gas-actual-nombre').value,
fijo:document.getElementById('gas-actual-fijo').value,
variable:document.getElementById('gas-actual-variable').value,
dto:document.getElementById('gas-actual-dto').value,
unit:document.querySelector('input[name="gas-actual-unit"]:checked').value
},
t3:{
nombre:document.getElementById('t3-actual-nombre').value,
potencias:document.getElementById('t3-actual-potencias').value,
energia:document.getElementById('t3-actual-energia').value,
dto:document.getElementById('t3-actual-dto').value
}
};
localStorage.setItem('ofertaActual',JSON.stringify(datos));
}

function resetNuevaOferta(){
if(tabActual==='t2'){
document.getElementById('t2-nueva-nombre').value='';
document.getElementById('t2-nueva-pot-punta-kw').value='';
document.getElementById('t2-nueva-pot-punta-precio').value='';
document.getElementById('t2-nueva-pot-valle-kw').value='';
document.getElementById('t2-nueva-pot-valle-precio').value='';
document.getElementById('t2-nueva-punta').value='';
document.getElementById('t2-nueva-llano').value='';
document.getElementById('t2-nueva-valle').value='';
document.getElementById('t2-nueva-dto').value='0';
document.querySelector('input[name="t2-nueva-unit-punta"][value="dia"]').checked=true;
document.querySelector('input[name="t2-nueva-unit-valle"][value="dia"]').checked=true;
}else if(tabActual==='gas'){
document.getElementById('gas-nueva-nombre').value='';
document.getElementById('gas-nueva-fijo').value='';
document.getElementById('gas-nueva-variable').value='';
document.getElementById('gas-nueva-dto').value='0';
document.querySelector('input[name="gas-nueva-unit"][value="dia"]').checked=true;
}else{
document.getElementById('t3-nueva-nombre').value='';
document.getElementById('t3-nueva-potencias').value='';
document.getElementById('t3-nueva-energia').value='';
document.getElementById('t3-nueva-dto').value='0';
}
}

function calcular(){
let nombreNueva='';
let totalActual=0,totalNueva=0;
let datosUsados='';

if(tabActual==='t2'){
const nombre=document.getElementById('t2-actual-nombre').value||'Actual T2';
nombreNueva=document.getElementById('t2-nueva-nombre').value||'Nueva T2';
const potPuntaKwA=parseFloat(document.getElementById('t2-actual-pot-punta-kw').value);
const potPuntaPrecioA=parseFloat(document.getElementById('t2-actual-pot-punta-precio').value);
const potValleKwA=parseFloat(document.getElementById('t2-actual-pot-valle-kw').value);
const potVallePrecioA=parseFloat(document.getElementById('t2-actual-pot-valle-precio').value);
const puntaA=parseFloat(document.getElementById('t2-actual-punta').value);
const llanoA=parseFloat(document.getElementById('t2-actual-llano').value);
const valleA=parseFloat(document.getElementById('t2-actual-valle').value);
const dtoA=parseFloat(document.getElementById('t2-actual-dto').value)||0;
const unitPuntaA=document.querySelector('input[name="t2-actual-unit-punta"]:checked').value;
const unitValleA=document.querySelector('input[name="t2-actual-unit-valle"]:checked').value;

const potPuntaKwN=parseFloat(document.getElementById('t2-nueva-pot-punta-kw').value);
const potPuntaPrecioN=parseFloat(document.getElementById('t2-nueva-pot-punta-precio').value);
const potValleKwN=parseFloat(document.getElementById('t2-nueva-pot-valle-kw').value);
const potVallePrecioN=parseFloat(document.getElementById('t2-nueva-pot-valle-precio').value);
const puntaN=parseFloat(document.getElementById('t2-nueva-punta').value);
const llanoN=parseFloat(document.getElementById('t2-nueva-llano').value);
const valleN=parseFloat(document.getElementById('t2-nueva-valle').value);
const dtoN=parseFloat(document.getElementById('t2-nueva-dto').value)||0;
const unitPuntaN=document.querySelector('input[name="t2-nueva-unit-punta"]:checked').value;
const unitValleN=document.querySelector('input[name="t2-nueva-unit-valle"]:checked').value;

if(isNaN(potPuntaKwA)||isNaN(potPuntaPrecioA)||isNaN(potValleKwA)||isNaN(potVallePrecioA)||isNaN(puntaA)||isNaN(llanoA)||isNaN(valleA)||
isNaN(potPuntaKwN)||isNaN(potPuntaPrecioN)||isNaN(potValleKwN)||isNaN(potVallePrecioN)||isNaN(puntaN)||isNaN(llanoN)||isNaN(valleN)){
alert('‚ö†Ô∏è Completa todos los campos T2');return;
}

const precPuntaA=aplicarDescuento(puntaA,dtoA);
const precLlanoA=aplicarDescuento(llanoA,dtoA);
const precValleA=aplicarDescuento(valleA,dtoA);
const precPuntaN=aplicarDescuento(puntaN,dtoN);
const precLlanoN=aplicarDescuento(llanoN,dtoN);
const precValleN=aplicarDescuento(valleN,dtoN);

if(modoT2==='mes'){
const consPunta=parseFloat(document.getElementById('t2-cons-punta').value)||50;
const consLlano=parseFloat(document.getElementById('t2-cons-llano').value)||35;
const consValle=parseFloat(document.getElementById('t2-cons-valle').value)||50;
datosUsados=`<p><strong>Consumo usado:</strong> Punta ${consPunta} kWh, Llano ${consLlano} kWh, Valle ${consValle} kWh</p>`;
const dias=30;
totalActual=consPunta*precPuntaA+consLlano*precLlanoA+consValle*precValleA;
totalNueva=consPunta*precPuntaN+consLlano*precLlanoN+consValle*precValleN;
const potPrecPuntaA=(unitPuntaA==='dia'?potPuntaPrecioA:potPuntaPrecioA/365)*dias;
const potPrecValleA=(unitValleA==='dia'?potVallePrecioA:potVallePrecioA/365)*dias;
const potPrecPuntaN=(unitPuntaN==='dia'?potPuntaPrecioN:potPuntaPrecioN/365)*dias;
const potPrecValleN=(unitValleN==='dia'?potVallePrecioN:potVallePrecioN/365)*dias;
totalActual+=(potPuntaKwA*potPrecPuntaA+potValleKwA*potPrecValleA);
totalNueva+=(potPuntaKwN*potPrecPuntaN+potValleKwN*potPrecValleN);
}else{
let totPunta=0,totLlano=0,totValle=0;
for(let i=0;i<12;i++){
const p=parseFloat(document.getElementById(`t2-punta-${i}`).value)||0;
const l=parseFloat(document.getElementById(`t2-llano-${i}`).value)||0;
const v=parseFloat(document.getElementById(`t2-valle-${i}`).value)||0;
const dias=consumosT2Default.dias[i];
totPunta+=p;totLlano+=l;totValle+=v;
totalActual+=p*precPuntaA+l*precLlanoA+v*precValleA;
totalNueva+=p*precPuntaN+l*precLlanoN+v*precValleN;
const potPrecPuntaA=(unitPuntaA==='dia'?potPuntaPrecioA:potPuntaPrecioA/365)*dias;
const potPrecValleA=(unitValleA==='dia'?potVallePrecioA:potVallePrecioA/365)*dias;
const potPrecPuntaN=(unitPuntaN==='dia'?potPuntaPrecioN:potPuntaPrecioN/365)*dias;
const potPrecValleN=(unitValleN==='dia'?potVallePrecioN:potVallePrecioN/365)*dias;
totalActual+=(potPuntaKwA*potPrecPuntaA+potValleKwA*potPrecValleA);
totalNueva+=(potPuntaKwN*potPrecPuntaN+potValleKwN*potPrecValleN);
}
datosUsados=`<p><strong>Consumo anual:</strong> Punta ${totPunta.toFixed(0)} kWh, Llano ${totLlano.toFixed(0)} kWh, Valle ${totValle.toFixed(0)} kWh</p>`;
}

}else if(tabActual==='gas'){
nombreNueva=document.getElementById('gas-nueva-nombre').value||'Nueva GAS';
const fijoA=parseFloat(document.getElementById('gas-actual-fijo').value);
const varA=parseFloat(document.getElementById('gas-actual-variable').value);
const dtoA=parseFloat(document.getElementById('gas-actual-dto').value)||0;
const unitA=document.querySelector('input[name="gas-actual-unit"]:checked').value;

const fijoN=parseFloat(document.getElementById('gas-nueva-fijo').value);
const varN=parseFloat(document.getElementById('gas-nueva-variable').value);
const dtoN=parseFloat(document.getElementById('gas-nueva-dto').value)||0;
const unitN=document.querySelector('input[name="gas-nueva-unit"]:checked').value;

if(isNaN(fijoA)||isNaN(varA)||isNaN(fijoN)||isNaN(varN)){alert('‚ö†Ô∏è Completa todos los campos GAS');return}

const precVarA=aplicarDescuento(varA,dtoA);
const precVarN=aplicarDescuento(varN,dtoN);
const precFijoA=unitA==='dia'?fijoA:fijoA/30.4167;
const precFijoN=unitN==='dia'?fijoN:fijoN/30.4167;

if(modoGas==='mes'){
const cons=parseFloat(document.getElementById('gas-cons').value)||1000;
datosUsados=`<p><strong>Consumo usado:</strong> ${cons} kWh</p>`;
const dias=30;
totalActual=cons*precVarA+precFijoA*dias;
totalNueva=cons*precVarN+precFijoN*dias;
}else{
let totKwh=0;
for(let i=0;i<12;i++){
const kwh=parseFloat(document.getElementById(`gas-kwh-${i}`).value)||0;
totKwh+=kwh;
totalActual+=kwh*precVarA+precFijoA*consumosGasDefault.dias[i];
totalNueva+=kwh*precVarN+precFijoN*consumosGasDefault.dias[i];
}
datosUsados=`<p><strong>Consumo anual:</strong> ${totKwh.toFixed(0)} kWh</p>`;
}

}else if(modoT3==='mes'){
nombreNueva=document.getElementById('t3-nueva-nombre').value||'Nueva T3';
const textoA=document.getElementById('t3-actual-potencias').value;
const textoN=document.getElementById('t3-nueva-potencias').value;
const energiaTextoA=document.getElementById('t3-actual-energia').value;
const energiaTextoN=document.getElementById('t3-nueva-energia').value;

if(!textoA||!textoN||!energiaTextoA||!energiaTextoN){alert('‚ö†Ô∏è Completa potencias y energ√≠a T3');return}

const potA=parsePotencias(textoA);
const potN=parsePotencias(textoN);
const enA=parseEnergia(energiaTextoA);
const enN=parseEnergia(energiaTextoN);

if(Object.keys(potA).length<6||Object.keys(potN).length<6){alert('‚ö†Ô∏è No se detectaron 6 potencias');return}
if(Object.keys(enA).length<1||Object.keys(enN).length<1){alert('‚ö†Ô∏è No se detectaron precios de energ√≠a');return}

const dtoA=parseFloat(document.getElementById('t3-actual-dto').value)||0;
const dtoN=parseFloat(document.getElementById('t3-nueva-dto').value)||0;
const mes=parseInt(document.getElementById('t3-mes').value);
const dias=diasMes[mes];

for(let j=1;j<=6;j++){
const p='P'+j;
if(potA[p])totalActual+=(potA[p].kw*potA[p].precio*dias);
if(potN[p])totalNueva+=(potN[p].kw*potN[p].precio*dias);
}

const precEnA=aplicarDescuento(enA.P1||Object.values(enA)[0]||0,dtoA);
const precEnN=aplicarDescuento(enN.P1||Object.values(enN)[0]||0,dtoN);
const consumoEst=500;
totalActual+=consumoEst*precEnA;
totalNueva+=consumoEst*precEnN;
datosUsados=`<p><strong>Consumo estimado:</strong> ${consumoEst} kWh</p>`;
}else{
nombreNueva=document.getElementById('t3-nueva-nombre').value||'Nueva T3';
let completoA=true,completoN=true;
for(let p=1;p<=6;p++){
if(!document.getElementById(`t3-p${p}-kw`).value||!document.getElementById(`t3-p${p}-precio-kw`).value||!document.getElementById(`t3-p${p}-energia`).value){completoA=false}
if(!document.getElementById(`t3-p${p}-kw`).value||!document.getElementById(`t3-p${p}-precio-kw`).value||!document.getElementById(`t3-p${p}-energia`).value){completoN=false}
}
if(!completoA||!completoN){alert('‚ö†Ô∏è Completa potencias y precios en T3 varios meses');return}

const mesesDin=generarMesesDinamicos();
for(let p=1;p<=6;p++){
const kw=parseFloat(document.getElementById(`t3-p${p}-kw`).value);
const precioKw=parseFloat(document.getElementById(`t3-p${p}-precio-kw`).value);
const precioEn=parseFloat(document.getElementById(`t3-p${p}-energia`).value);
const dtoAVal=parseFloat(document.getElementById('t3-actual-dto').value)||0;
const dtoNVal=parseFloat(document.getElementById('t3-nueva-dto').value)||0;

for(let m=0;m<12;m++){
const kwhA=parseFloat(document.getElementById(`t3-p${p}-kwh-${m}`).value)||0;
const kwhN=parseFloat(document.getElementById(`t3-p${p}-kwh-${m}`).value)||0;
const dias=mesesDin[m].numero===1?28:(mesesDin[m].numero%2===0&&mesesDin[m].numero<=7||mesesDin[m].numero%2===1&&mesesDin[m].numero>7)?31:30;
const precEnA=aplicarDescuento(precioEn,dtoAVal);
const precEnN=aplicarDescuento(precioEn,dtoNVal);

totalActual+=(kw*precioKw*dias)+(kwhA*precEnA);
totalNueva+=(kw*precioKw*dias)+(kwhN*precEnN);
}
}
datosUsados=`<p><strong>Consumo anual T3:</strong> Tabla de 12 meses</p>`;
}

guardarDatos();
const ahorro=-(totalActual-totalNueva);
mostrarResultados(totalActual,totalNueva,ahorro,datosUsados);
guardarHistorico(nombreNueva,totalNueva,ahorro);
}

function mostrarResultados(actual,nueva,ahorro,datosUsados){
const periodo=tabActual==='t2'&&modoT2==='varios'||tabActual==='gas'&&modoGas==='varios'?'Anual':'Mensual';
const hayAhorro=ahorro<0;
const mensaje=hayAhorro?'Hay ahorro. Interesa cambiarse':'No hay ahorro, mejor la oferta actual';
const claseResultado=hayAhorro?'ahorro':'no-ahorro';

let resultBoxActual='';
let resultBoxNueva='';

if(!hayAhorro){
resultBoxActual=`<div class="result-box ${claseResultado}"><h3>${mensaje}</h3><div class="amount">${Math.abs(ahorro).toFixed(2)} ‚Ç¨ m√°s caro</div></div>`;
}else{
resultBoxNueva=`<div class="result-box ${claseResultado}"><h3>${mensaje}</h3><div class="amount">${Math.abs(ahorro).toFixed(2)} ‚Ç¨ ahorro</div></div>`;
}

const html=`<div class="results-header">üí∞ Resultados</div>
${datosUsados?`<div class="datos-usados"><h3>üìä Datos utilizados en el c√°lculo</h3>${datosUsados}</div>`:''}
<div class="summary">
<div class="summary-card">
<div class="summary-label">Total ${periodo} - Oferta Actual</div>
<div class="summary-amount">${actual.toFixed(2)} ‚Ç¨</div>
${resultBoxActual}
</div>
<div class="summary-card nueva">
<div class="summary-label">Total ${periodo} - Oferta Nueva</div>
<div class="summary-amount">${nueva.toFixed(2)} ‚Ç¨</div>
${resultBoxNueva}
</div>
</div>`;

document.getElementById('results').innerHTML=html;
document.getElementById('results').classList.remove('hidden');
document.getElementById('results').scrollIntoView({behavior:'smooth',block:'start'});
}

function guardarHistorico(nombre,total,ahorro){
let hist=JSON.parse(localStorage.getItem('historicoOfertas')||'[]');
hist.push({id:Date.now(),nombre:nombre,total:total,ahorro:ahorro,fecha:new Date().toLocaleString('es-ES')});
localStorage.setItem('historicoOfertas',JSON.stringify(hist));
mostrarHistorico();
}

function mostrarHistorico(){
const hist=JSON.parse(localStorage.getItem('historicoOfertas')||'[]');
const container=document.getElementById('historico-list');
if(hist.length===0){container.innerHTML='<div class="historico-empty">No hay ofertas guardadas</div>';document.getElementById('historico').classList.add('hidden');return}
document.getElementById('historico').classList.remove('hidden');
container.innerHTML='';
hist.reverse().forEach(o=>{
const item=document.createElement('div');
item.className='historico-item';
const aClass=o.ahorro<0?'positive':(o.ahorro>0?'negative':'');
item.innerHTML=`<div class="historico-nombre">${o.nombre}</div><div class="historico-total">${o.total.toFixed(2)} ‚Ç¨</div><div class="historico-ahorro ${aClass}">${o.ahorro.toFixed(2)} ‚Ç¨</div><button class="historico-delete" onclick="eliminarOferta(${o.id})">üóëÔ∏è</button>`;
container.appendChild(item);
});
}

function eliminarOferta(id){
if(!confirm('¬øEliminar?'))return;
let hist=JSON.parse(localStorage.getItem('historicoOfertas')||'[]');
hist=hist.filter(o=>o.id!==id);
localStorage.setItem('historicoOfertas',JSON.stringify(hist));
mostrarHistorico();
}

function limpiarHistorico(){
if(!confirm('¬øEliminar TODO?'))return;
localStorage.removeItem('historicoOfertas');
mostrarHistorico();
}

function exportarHistorico(){
const data={ofertaActual:JSON.parse(localStorage.getItem('ofertaActual')||'{}'),historico:JSON.parse(localStorage.getItem('historicoOfertas')||'[]'),exportDate:new Date().toISOString()};
const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
const url=URL.createObjectURL(blob);
const a=document.createElement('a');
a.href=url;
a.download=`historico_${new Date().toISOString().split('T')[0]}.json`;
a.click();
URL.revokeObjectURL(url);
}

function importarHistorico(e){
const file=e.target.files[0];
if(!file)return;
const reader=new FileReader();
reader.onload=function(ev){
try{
const data=JSON.parse(ev.target.result);
if(data.ofertaActual){localStorage.setItem('ofertaActual',JSON.stringify(data.ofertaActual));cargarDatos()}
if(data.historico){localStorage.setItem('historicoOfertas',JSON.stringify(data.historico));mostrarHistorico()}
alert('‚úÖ Importado');
}catch(err){alert('‚ùå Error')}
};
reader.readAsText(file);
e.target.value='';
}
</script>
</body>
</html>